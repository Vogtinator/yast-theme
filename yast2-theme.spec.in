@HEADER-COMMENT@

@HEADER@
BuildRequires:	yast2-devtools yast2 pkg-config update-desktop-files hicolor-icon-theme fdupes
BuildArchitectures: noarch
Summary:	-
%description
-

%package openSUSE
Summary:	-
Version:	@VERSION@
Group:		System/YaST
Provides:	yast2_theme = %{version}
Provides:	yast2-theme-UnitedLinux
PreReq:		/bin/ln
Requires:	hicolor-icon-theme
Obsoletes:	yast2-theme-SuSELinux
Provides:       yast2-theme-SuSELinux
Obsoletes:	yast2-theme-UnitedLinux
Provides:       yast2-theme-UnitedLinux

%package openSUSE-Crystal
Summary:	-
Version:	@VERSION@
Group:		System/YaST
Provides:	yast2_theme = %{version}
PreReq:		/bin/ln yast2-theme-openSUSE

%package openSUSE-Oxygen
Summary:	-
Version:	@VERSION@
Group:		System/YaST
Provides:	yast2_theme = %{version}
PreReq:		/bin/ln yast2-theme-openSUSE
Conflicts:      yast2-theme-openSUSE-Crystal

%description openSUSE
-

%description openSUSE-Crystal
-

%description openSUSE-Oxygen
-

@PREP@

@BUILD@

@INSTALL@
cp -R "$RPM_BUILD_ROOT/@docdir@" "$RPM_BUILD_ROOT/@docdir@-openSUSE"
rm -rf "$RPM_BUILD_ROOT/@docdir@"
# ghost file (not packed in RPM but listed)
cd $RPM_BUILD_ROOT/@themedir@/
rm -rf current
ln -sn openSUSE current
#
# make icons available to GNOME control center (hicolor theme)
# (bug #166008)
mkdir -p $RPM_BUILD_ROOT/usr/share/icons/hicolor/22x22/apps
mkdir -p $RPM_BUILD_ROOT/usr/share/icons/hicolor/32x32/apps
mkdir -p $RPM_BUILD_ROOT/usr/share/icons/hicolor/48x48/apps
cd $RPM_BUILD_ROOT/@themedir@/current/icons
for dir in 22x22 32x32 48x48; do
    cd $RPM_BUILD_ROOT/@themedir@/current/icons/$dir/apps
    icons=$(ls *.png)
    cd $RPM_BUILD_ROOT/usr/share/icons/hicolor/$dir/apps
    for icon in $icons; do
        ln -s @themedir@/current/icons/$dir/apps/$icon .
    done
done
filelist=$(mktemp /tmp/fileListXXXXXX)
cd $RPM_BUILD_ROOT/@themedir@/openSUSE
files=$(find . -type f)
for subtheme in Crystal Oxygen; do
  cd $RPM_BUILD_ROOT/@themedir@/openSUSE-$subtheme
  for file in $files; do
    mkdir $(dirname "$file") || true
    if ! test -f "$file"; then
     ln -s @themedir@/openSUSE/$file $file
    fi
  done
done
%fdupes $RPM_BUILD_ROOT/@themedir@

@CLEAN@
rm -rf $RPM_BUILD_ROOT/@themedir@

%post openSUSE
cd @themedir@
if ! test -d openSUSE-Crystal && ! test -d openSUSE-Oxygen; then
  ln -snf openSUSE current
fi

%post openSUSE-Crystal
cd @themedir@
ln -snf openSUSE-Crystal current

%post openSUSE-Oxygen
cd @themedir@
ln -snf openSUSE-Oxygen current

%files openSUSE
%defattr(-,root,root)
%dir @themedir@
@themedir@/openSUSE
/usr/share/icons/hicolor/22x22/apps/*
/usr/share/icons/hicolor/32x32/apps/*
/usr/share/icons/hicolor/48x48/apps/*
%doc @docdir@-openSUSE
# ghost file (not packed in RPM but listed)
# remove the file when removing the RPM
%ghost @themedir@/current

%files openSUSE-Crystal
%defattr(-,root,root)
%dir @themedir@
@themedir@/openSUSE-Crystal

%files openSUSE-Oxygen
%defattr(-,root,root)
%dir @themedir@
@themedir@/openSUSE-Oxygen


